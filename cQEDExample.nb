(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     66254,       1644]
NotebookOptionsPosition[     64688,       1587]
NotebookOutlinePosition[     65067,       1604]
CellTagsIndexPosition[     65024,       1601]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Apparently", " ", "path", " ", "needs", " ", "to", " ", "be", " ", 
    "appended", " ", "every", " ", "time", " ", "a", " ", "session", " ", 
    "is", " ", "opened"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"FreeQ", "[", 
       RowBox[{"$Path", ",", "\"\</path/\>\""}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"AppendTo", "[", 
        RowBox[{"$Path", ",", "\"\</path/\>\""}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Needs", "[", "\"\<cQEDNetworks`\>\"", "]"}], ";"}]}]}]], "Input",\

 CellChangeTimes->{{3.7016763962346497`*^9, 3.7016764643231897`*^9}, {
  3.701676594712331*^9, 3.70167659649684*^9}, {3.702070959059544*^9, 
  3.702070981435265*^9}, {3.702071158739122*^9, 3.702071163657037*^9}, {
  3.702071274975294*^9, 3.7020712774351254`*^9}, {3.702219078178282*^9, 
  3.702219088690875*^9}, {3.7022191689102907`*^9, 3.702219207391387*^9}, {
  3.702219259296049*^9, 3.702219265437943*^9}, {3.7022329676062117`*^9, 
  3.7022329723003674`*^9}}],

Cell[TextData[{
 "Some naming conventions.\n",
 StyleBox["Graphs",
  FontWeight->"Bold"],
 " are made of ",
 StyleBox["edges",
  FontSlant->"Italic"],
 " i.e. ",
 StyleBox["branches",
  FontSlant->"Italic"],
 " and nodes.\n\nThe connected path of edges and vertices along the graph \
whose initial and final vertices are equal is a ",
 StyleBox["cycle",
  FontWeight->"Bold",
  FontSlant->"Italic"],
 StyleBox["/loop/circuit",
  FontSlant->"Italic"],
 " (other edges are only traversed max once). Those who use \
\[OpenCurlyQuote]circuit\[CloseCurlyQuote], reserve \[OpenCurlyQuote]loop\
\[CloseCurlyQuote]  for the edges with two same end nodes. As our graphs \
represent circuits, we prefer the terms cycle and loop.\n\n",
 StyleBox["Spanning tree",
  FontSlant->"Italic"],
 " is the connected path of edges whose end nodes includes all the nodes, but \
not a single cycle. ",
 StyleBox["Active branch",
  FontSlant->"Italic"],
 " is an edge that belongs to a spanning tree. Some sources (graph theorists, \
who do not use this term for edges) call these as the branches. ",
 StyleBox["Closure branch",
  FontSlant->"Italic"],
 " is an edge that belongs to the ",
 StyleBox["co-spanning tree,",
  FontSlant->"Italic"],
 " i.e. the complement of the set of edges of the spanning tree. \n\nDevoret \
compares the choice of a ground node and the spanning tree to a choice of \
electromagnetic gauge. Here, we do not give an algorithm for finding an \
\[OpenCurlyQuote]optimal\[CloseCurlyQuote] spanning tree (e.g. minimum \
spanning trees are considered optimal for weighted graphs, but here the \
weights, i.e. branch fluxes are symbolic). Instead the choice is left to the \
user. We do include a function, however, which finds some of the spanning \
trees as well as the total number of possible spanning trees. "
}], "Text",
 CellChangeTimes->{{3.701828498855761*^9, 3.70182852072066*^9}, {
   3.701828555068758*^9, 3.701828587153153*^9}, {3.7018286235178556`*^9, 
   3.7018287212231693`*^9}, {3.7018287635787487`*^9, 3.701829029703101*^9}, {
   3.7018290626196012`*^9, 3.701829236878127*^9}, {3.70188179296454*^9, 
   3.701881846533473*^9}, {3.701881987091505*^9, 3.70188211688463*^9}, {
   3.701882420861393*^9, 3.701882472913209*^9}, 3.702066182930769*^9, {
   3.702092723037365*^9, 3.702092869172028*^9}, 3.702219604657569*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"CPBb", "    ", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<s\>\"", ",", "\"\<p\>\"", ",", "\"\<JC\>\"", ",", "\"\<J\>\""}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CPBbtype", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<C\>\"", ",", "\"\<C\>\"", ",", "\"\<C\>\"", ",", "\"\<J\>\""}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CPBn", "   ", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<gnd\>\"", ",", "\"\<p\>\"", ",", "\"\<J\>\""}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"CPBC", "   ", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CPBPhi", " ", "=", 
    RowBox[{"{", "}"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Automatic", " ", "names", " ", "for", " ", "capacitances"}], ",",
     " ", "branch", ",", " ", 
    RowBox[{"and", " ", "node", " ", "fluxes"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"Do", "[", "\n", "  ", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringMatchQ", "[", 
        RowBox[{
         RowBox[{"CPBbtype", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<C\>\""}], "]"}], ",", 
       "\n", "    ", 
       RowBox[{
        RowBox[{"CPBC", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"CPBC", ",", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"Symbol", "[", 
             RowBox[{"\"\<C\>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"CPBb", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], 
          "]"}]}], ";"}], "\n", "  ", ",", "\n", "  ", 
       RowBox[{"CPBC", "=", 
        RowBox[{"Append", "[", 
         RowBox[{"CPBC", ",", "0"}], "]"}]}]}], "]"}], ";", "\n", "  ", 
     RowBox[{"CPBPhi", "=", 
      RowBox[{"Append", "[", 
       RowBox[{"CPBPhi", ",", 
        RowBox[{"Evaluate", "[", 
         RowBox[{"Symbol", "[", 
          RowBox[{"\"\<Phi\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"CPBb", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], "]"}]}],
      ";"}], "\n", ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "CPBb", "]"}]}], "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CPBphi", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Do", "[", "\n", "  ", 
   RowBox[{
    RowBox[{"CPBphi", "=", 
     RowBox[{"Append", "[", 
      RowBox[{"CPBphi", ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Symbol", "[", 
         RowBox[{"\"\<phi\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"CPBn", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], "]"}]}], 
    "\n", ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "CPBn", "]"}]}], "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CPBdPhi", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"CPBPhi", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", 
     RowBox[{"CPBPhi", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"Dynamical", " ", "degrees", " ", "of", " ", "freedom"}], "*)"}], 
  "\n", 
  RowBox[{"CPBIM", "=", "\n", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "0", ",", 
       RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", "\n", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", "\n", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "1", ",", 
       RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ";"}]}], "Code",
 CellChangeTimes->{
  3.702216897860824*^9, {3.702216940623698*^9, 3.702216944910499*^9}, {
   3.702216993720365*^9, 3.702217061776925*^9}, {3.702217144950613*^9, 
   3.702217200858127*^9}, {3.702217234371573*^9, 3.702217288408242*^9}, {
   3.7022173740634613`*^9, 3.702217394610155*^9}, {3.7022174602334023`*^9, 
   3.7022176380671864`*^9}, {3.702218920808552*^9, 3.702218968524461*^9}, {
   3.702219507065743*^9, 3.702219533073745*^9}, 3.70221958718043*^9, {
   3.702219695331181*^9, 3.702219763458343*^9}, {3.7022198124197063`*^9, 
   3.702219833114032*^9}, {3.702219948736595*^9, 3.702219949294012*^9}, 
   3.702220015937276*^9, {3.702220071321662*^9, 3.702220072097567*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"transmonb", "    ", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<s\>\"", ",", "\"\<p\>\"", ",", "\"\<rC\>\"", ",", "\"\<r\>\"", ",", 
     "\"\<g\>\"", ",", "\"\<JC\>\"", ",", "\"\<J\>\""}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"transmonbtype", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<C\>\"", ",", "\"\<C\>\"", ",", "\"\<C\>\"", ",", "\"\<L\>\"", ",", 
     "\"\<C\>\"", ",", "\"\<C\>\"", ",", "\"\<L\>\""}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"transmonC", "    ", "=", 
   RowBox[{"{", 
    RowBox[{
    "Cs", ",", "Cp", ",", "Cr", ",", "0", ",", "Cg", ",", "CJ", ",", "0"}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"transmonPhi", "  ", "=", 
   RowBox[{"{", 
    RowBox[{
    "Phis", ",", "Phip", ",", "PhirC", ",", "Phir", ",", "Phig", ",", "PhiJC",
      ",", "PhiJ"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"transmondPhi", " ", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"transmonPhi", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", 
     RowBox[{"transmonPhi", "[", 
      RowBox[{"[", "4", "]"}], "]"}], ",", 
     RowBox[{"transmonPhi", "[", 
      RowBox[{"[", "7", "]"}], "]"}]}], "}"}]}], ";", " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Number", " ", "of", " ", "dynamical", " ", "dofs"}], "=", 
    RowBox[{
     RowBox[{"Length", "[", "n", "]"}], "-", "1"}]}], "*)"}], "\n", 
  RowBox[{"transmonn", "    ", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<gnd\>\"", ",", "\"\<p\>\"", ",", "\"\<r\>\"", ",", "\"\<J\>\""}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"transmonphi", "  ", "=", 
   RowBox[{"{", 
    RowBox[{"phignd", ",", "phip", ",", "phir", ",", "phiJ"}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"transmonIM", "=", "\n", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "0", ",", 
       RowBox[{"-", "1"}], ",", "1", ",", "0", ",", 
       RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", "\n", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"-", "1"}], ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}],
       "}"}], ",", "\n", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "1", ",", 
       RowBox[{"-", "1"}], ",", 
       RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", "\n", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", 
       RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.70150559037672*^9, 3.7015056447965193`*^9}, {
   3.70150569994128*^9, 3.701505703933991*^9}, {3.7015057517063932`*^9, 
   3.701505773135831*^9}, {3.701505934592634*^9, 3.701506043906546*^9}, {
   3.701506217175787*^9, 3.7015062410460176`*^9}, {3.701506566569051*^9, 
   3.701506589537422*^9}, {3.701506625859734*^9, 3.701506640171254*^9}, {
   3.701506811116996*^9, 3.701506848772266*^9}, {3.701507058560314*^9, 
   3.701507074804666*^9}, {3.701642857815139*^9, 3.701642858261915*^9}, 
   3.7020707723210907`*^9, {3.702094514817753*^9, 3.702094515926581*^9}, {
   3.702212186022688*^9, 3.702212186945031*^9}, {3.702214178121348*^9, 
   3.702214184380158*^9}, {3.7022142209255753`*^9, 3.702214226150635*^9}, {
   3.702216686403036*^9, 3.702216695695825*^9}, 3.702216892674655*^9, {
   3.702217398219956*^9, 3.702217398508801*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"b", "    ", "=", "CPBb"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"btype", "=", "CPBbtype"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"bC", "   ", "=", "CPBC"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Phi", "  ", "=", "CPBPhi"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"dPhi", " ", "=", "CPBdPhi"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"rPhi", " ", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Do", "[", "\n", "  ", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"dPhi", ",", 
         RowBox[{"Phi", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"rPhi", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"rPhi", ",", 
           RowBox[{"Phi", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";"}]}], "\n", "  ", 
      "]"}], ";"}], "\n", ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"n", "    ", "=", "CPBn"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"phi", "  ", "=", "CPBphi"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"IM", "   ", "=", "CPBIM"}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"b", "    ", "=", "transmonb"}], ";", "\[IndentingNewLine]", 
    RowBox[{"btype", "=", "transmonbtype"}], ";", "\n", 
    RowBox[{"bC", "   ", "=", "transmonC"}], ";", "\n", 
    RowBox[{"Phi", "  ", "=", "transmonPhi"}], ";", "\n", 
    RowBox[{"dPhi", " ", "=", "transmondPhi"}], ";", "\n", 
    RowBox[{"rPhi", " ", "=", 
     RowBox[{"{", "}"}]}], ";", "\n", 
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"dPhi", ",", 
           RowBox[{"Phi", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", "\n", "\t", 
         RowBox[{
          RowBox[{"rPhi", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"rPhi", ",", 
             RowBox[{"Phi", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";"}]}], "\n", "  ", 
        "]"}], ";"}], "\n", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}], ";", "\n", 
    RowBox[{"n", "    ", "=", "transmonn"}], ";", "\n", 
    RowBox[{"phi", "  ", "=", "transmonphi"}], ";", "\n", 
    RowBox[{"IM", "   ", "=", "transmonIM"}], ";"}], "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"g0", "=", 
   RowBox[{"IncidenceGraph", "[", "IM", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"g", "=", 
   RowBox[{"IncidenceGraph", "[", 
    RowBox[{"IM", ",", "\n", 
     RowBox[{"EdgeLabels", "\[Rule]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"EdgeList", "[", "g0", "]"}], "[", 
          RowBox[{"[", "ib", "]"}], "]"}], "\[Rule]", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"b", "[", 
            RowBox[{"[", "ib", "]"}], "]"}], ",", 
           RowBox[{"FontSize", "\[Rule]", "14"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ib", ",", "1", ",", 
          RowBox[{"Length", "[", "b", "]"}]}], "}"}]}], "]"}]}], ",", "\n", 
     RowBox[{"VertexLabels", "\[Rule]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"in", "\[Rule]", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"n", "[", 
            RowBox[{"[", "in", "]"}], "]"}], ",", 
           RowBox[{"FontSize", "\[Rule]", "14"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"in", ",", "1", ",", 
          RowBox[{"Length", "[", "n", "]"}]}], "}"}]}], "]"}]}]}], "\n", 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<g is a graph of \>\"", ",", 
    RowBox[{"Length", "[", "n", "]"}], ",", "\"\< nodes and \>\"", ",", 
    RowBox[{"Length", "[", "b", "]"}], ",", 
    "\"\< branches, named according to the following figure.\>\""}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Print", "[", "g", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{
   "\"\<The graph is drawn based on its incidence matrix, IM=\>\"", ",", 
    RowBox[{"MatrixForm", "[", "IM", "]"}], ",", "\"\<.\>\""}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
  "Print", "[", 
   "\"\<Each branch is also associated with a type, a branch flux variable, \
and a \\ncapacitance (0 if he branch is not capacitive.)\>\"", "]"}], 
  ";"}]}], "Code",
 CellChangeTimes->{
  3.70150624541849*^9, {3.701506363374247*^9, 3.7015063996918592`*^9}, {
   3.7015064568380213`*^9, 3.701506462785316*^9}, {3.7015066115763807`*^9, 
   3.701506617870105*^9}, {3.70150664993491*^9, 3.7015066504633217`*^9}, {
   3.701507081089459*^9, 3.7015070907690287`*^9}, {3.701507135674983*^9, 
   3.7015071564172277`*^9}, {3.701507230316041*^9, 3.701507356658416*^9}, {
   3.7015077576360207`*^9, 3.7015077849156513`*^9}, {3.7015078292076483`*^9, 
   3.701507831007701*^9}, 3.702070788449338*^9, {3.7022142419617453`*^9, 
   3.702214247464738*^9}, {3.702217403680622*^9, 3.702217403932466*^9}, {
   3.702219312314021*^9, 3.702219433856435*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"g is a graph of \"\>", "\[InvisibleSpace]", "3", 
   "\[InvisibleSpace]", "\<\" nodes and \"\>", "\[InvisibleSpace]", "4", 
   "\[InvisibleSpace]", "\<\" branches, named according to the following \
figure.\"\>"}],
  SequenceForm[
  "g is a graph of ", 3, " nodes and ", 4, 
   " branches, named according to the following figure."],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.702070872364849*^9, 3.702071010951618*^9, 3.702071106750738*^9, 
   3.70207116759515*^9, 3.702071293945712*^9, 3.702071554187001*^9, 
   3.70207163844765*^9, 3.70209263501792*^9, 3.7020934775428247`*^9, 
   3.7020935932653847`*^9, {3.702094408784306*^9, 3.702094436324802*^9}, 
   3.702094519781176*^9, 3.702094632592325*^9, 3.702095194519924*^9, 
   3.70209577557765*^9, 3.702097178156558*^9, 3.7020972301226177`*^9, 
   3.702097290981964*^9, {3.7020976317358427`*^9, 3.702097658684614*^9}, {
   3.702212097490589*^9, 3.7022121303428917`*^9}, {3.702212197080709*^9, 
   3.702212224271888*^9}, 3.702214091414287*^9, 3.70221425901793*^9, 
   3.702219435300708*^9, 3.7022195549359617`*^9, 3.702219621429701*^9, 
   3.702219842201888*^9, 3.7022199536518784`*^9, 3.702220075053103*^9, 
   3.702228172092371*^9}],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3}, {{{1, 2}, {2, 3}, {1, 3}, {3, 1}}, Null}, {
      EdgeLabels -> {
        DirectedEdge[2, 3] -> Style["p", FontSize -> 14], DirectedEdge[3, 1] -> 
         Style["J", FontSize -> 14], DirectedEdge[1, 3] -> 
         Style["JC", FontSize -> 14], DirectedEdge[1, 2] -> 
         Style["s", FontSize -> 14]}, 
       VertexLabels -> {
        1 -> Style["gnd", FontSize -> 14], 2 -> Style["p", FontSize -> 14], 3 -> 
         Style["J", FontSize -> 14]}}]], Typeset`boxes, Typeset`boxes$s2d = 
    GraphicsGroupBox[{{
       Arrowheads[0.041583416688098084`], 
       Directive[
        Opacity[0.7], 
        Hue[0.6, 0.7, 0.5]], {
        TagBox[
         ArrowBox[{
           DynamicLocation["VertexID$1", Automatic, Center], 
           DynamicLocation["VertexID$2", Automatic, Center]}], "DynamicName", 
         BoxID -> "EdgeLabelID$1"], 
        InsetBox[
         FormBox[
          StyleBox["\"s\"", FontSize -> 14, StripOnInput -> False], 
          TraditionalForm], 
         DynamicLocation["EdgeLabelID$1", Automatic, 
          Scaled[0.5]], 
         ImageScaled[{0.5, 0.5}], BaseStyle -> "Graphics"]}, {
        TagBox[
         ArrowBox[
          BezierCurveBox[{
            DynamicLocation["VertexID$1", Automatic, Center], {
            0.5024283991048363, 1.021174467912481}, 
            DynamicLocation["VertexID$3", Automatic, Center]}]], 
         "DynamicName", BoxID -> "EdgeLabelID$2"], 
        InsetBox[
         FormBox[
          StyleBox["\"JC\"", FontSize -> 14, StripOnInput -> False], 
          TraditionalForm], 
         DynamicLocation["EdgeLabelID$2", Automatic, 
          Scaled[0.5]], 
         ImageScaled[{0.5, 0.5}], BaseStyle -> "Graphics"]}, {
        TagBox[
         ArrowBox[{
           DynamicLocation["VertexID$2", Automatic, Center], 
           DynamicLocation["VertexID$3", Automatic, Center]}], "DynamicName", 
         BoxID -> "EdgeLabelID$3"], 
        InsetBox[
         FormBox[
          StyleBox["\"p\"", FontSize -> 14, StripOnInput -> False], 
          TraditionalForm], 
         DynamicLocation["EdgeLabelID$3", Automatic, 
          Scaled[0.5]], 
         ImageScaled[{0.5, 0.5}], BaseStyle -> "Graphics"]}, {
        TagBox[
         ArrowBox[
          BezierCurveBox[{
            DynamicLocation["VertexID$3", Automatic, Center], {
            0.49744275568184765`, 0.7106530658280898}, 
            DynamicLocation["VertexID$1", Automatic, Center]}]], 
         "DynamicName", BoxID -> "EdgeLabelID$4"], 
        InsetBox[
         FormBox[
          StyleBox["\"J\"", FontSize -> 14, StripOnInput -> False], 
          TraditionalForm], 
         DynamicLocation["EdgeLabelID$4", Automatic, 
          Scaled[0.5]], 
         ImageScaled[{0.5, 0.5}], BaseStyle -> "Graphics"]}}, {
       Directive[
        Hue[0.6, 0.2, 0.8], 
        EdgeForm[
         Directive[
          GrayLevel[0], 
          Opacity[0.7]]]], 
       TagBox[{
         TagBox[
          DiskBox[{0., 0.8739405904857203}, 0.012728359800434486`], 
          "DynamicName", BoxID -> "VertexID$1"], 
         InsetBox[
          FormBox[
           StyleBox["\"gnd\"", FontSize -> 14, StripOnInput -> False], 
           TraditionalForm], 
          Offset[{2, 2}, 
           DynamicLocation["VertexID$1", Automatic, {Right, Top}]], 
          ImageScaled[{0, 0}], BaseStyle -> "Graphics"]}, "DynamicName", 
        BoxID -> "VertexLabelID$1"], 
       TagBox[{
         TagBox[
          DiskBox[{0.48603265900633064`, 0.}, 0.012728359800434486`], 
          "DynamicName", BoxID -> "VertexID$2"], 
         InsetBox[
          FormBox[
           StyleBox["\"p\"", FontSize -> 14, StripOnInput -> False], 
           TraditionalForm], 
          Offset[{2, 2}, 
           DynamicLocation["VertexID$2", Automatic, {Right, Top}]], 
          ImageScaled[{0, 0}], BaseStyle -> "Graphics"]}, "DynamicName", 
        BoxID -> "VertexLabelID$2"], 
       TagBox[{
         TagBox[
          
          DiskBox[{0.9998711547866839, 0.8578869432548504}, 
           0.012728359800434486`], "DynamicName", BoxID -> "VertexID$3"], 
         InsetBox[
          FormBox[
           StyleBox["\"J\"", FontSize -> 14, StripOnInput -> False], 
           TraditionalForm], 
          Offset[{2, 2}, 
           DynamicLocation["VertexID$3", Automatic, {Right, Top}]], 
          ImageScaled[{0, 0}], BaseStyle -> "Graphics"]}, "DynamicName", 
        BoxID -> "VertexLabelID$3"]}}], $CellContext`flag}, 
    TagBox[
     DynamicBox[GraphComputation`NetworkGraphicsBox[
      3, Typeset`graph, Typeset`boxes, $CellContext`flag], {
      CachedValue :> Typeset`boxes, SingleEvaluation -> True, 
       SynchronousUpdating -> False, TrackedSymbols :> {$CellContext`flag}},
      ImageSizeCache->{{3.9406933090100935`, 
       361.5133165088599}, {-179.2393066909899, 174.65437682903553`}}],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False,
    UnsavedVariables:>{$CellContext`flag}]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FrameTicks->None]], "Print",
 CellChangeTimes->{
  3.702070872364849*^9, 3.702071010951618*^9, 3.702071106750738*^9, 
   3.70207116759515*^9, 3.702071293945712*^9, 3.702071554187001*^9, 
   3.70207163844765*^9, 3.70209263501792*^9, 3.7020934775428247`*^9, 
   3.7020935932653847`*^9, {3.702094408784306*^9, 3.702094436324802*^9}, 
   3.702094519781176*^9, 3.702094632592325*^9, 3.702095194519924*^9, 
   3.70209577557765*^9, 3.702097178156558*^9, 3.7020972301226177`*^9, 
   3.702097290981964*^9, {3.7020976317358427`*^9, 3.702097658684614*^9}, {
   3.702212097490589*^9, 3.7022121303428917`*^9}, {3.702212197080709*^9, 
   3.702212224271888*^9}, 3.702214091414287*^9, 3.70221425901793*^9, 
   3.702219435300708*^9, 3.7022195549359617`*^9, 3.702219621429701*^9, 
   3.702219842201888*^9, 3.7022199536518784`*^9, 3.702220075053103*^9, 
   3.702228172185849*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"The graph is drawn based on its incidence matrix, IM=\"\>", 
   "\[InvisibleSpace]", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        RowBox[{"-", "1"}], "0", 
        RowBox[{"-", "1"}], "1"},
       {"1", 
        RowBox[{"-", "1"}], "0", "0"},
       {"0", "1", "1", 
        RowBox[{"-", "1"}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]], "\[InvisibleSpace]", "\<\".\"\>"}],
  SequenceForm["The graph is drawn based on its incidence matrix, IM=", 
   MatrixForm[{{-1, 0, -1, 1}, {1, -1, 0, 0}, {0, 1, 1, -1}}], "."],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.702070872364849*^9, 3.702071010951618*^9, 3.702071106750738*^9, 
   3.70207116759515*^9, 3.702071293945712*^9, 3.702071554187001*^9, 
   3.70207163844765*^9, 3.70209263501792*^9, 3.7020934775428247`*^9, 
   3.7020935932653847`*^9, {3.702094408784306*^9, 3.702094436324802*^9}, 
   3.702094519781176*^9, 3.702094632592325*^9, 3.702095194519924*^9, 
   3.70209577557765*^9, 3.702097178156558*^9, 3.7020972301226177`*^9, 
   3.702097290981964*^9, {3.7020976317358427`*^9, 3.702097658684614*^9}, {
   3.702212097490589*^9, 3.7022121303428917`*^9}, {3.702212197080709*^9, 
   3.702212224271888*^9}, 3.702214091414287*^9, 3.70221425901793*^9, 
   3.702219435300708*^9, 3.7022195549359617`*^9, 3.702219621429701*^9, 
   3.702219842201888*^9, 3.7022199536518784`*^9, 3.702220075053103*^9, 
   3.702228172194148*^9}],

Cell[BoxData["\<\"Each branch is also associated with a type, a branch flux \
variable, and a \\ncapacitance (0 if he branch is not capacitive.)\"\>"], \
"Print",
 CellChangeTimes->{
  3.702070872364849*^9, 3.702071010951618*^9, 3.702071106750738*^9, 
   3.70207116759515*^9, 3.702071293945712*^9, 3.702071554187001*^9, 
   3.70207163844765*^9, 3.70209263501792*^9, 3.7020934775428247`*^9, 
   3.7020935932653847`*^9, {3.702094408784306*^9, 3.702094436324802*^9}, 
   3.702094519781176*^9, 3.702094632592325*^9, 3.702095194519924*^9, 
   3.70209577557765*^9, 3.702097178156558*^9, 3.7020972301226177`*^9, 
   3.702097290981964*^9, {3.7020976317358427`*^9, 3.702097658684614*^9}, {
   3.702212097490589*^9, 3.7022121303428917`*^9}, {3.702212197080709*^9, 
   3.702212224271888*^9}, 3.702214091414287*^9, 3.70221425901793*^9, 
   3.702219435300708*^9, 3.7022195549359617`*^9, 3.702219621429701*^9, 
   3.702219842201888*^9, 3.7022199536518784`*^9, 3.702220075053103*^9, 
   3.70222817219545*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Find", " ", "all", " ", "the", " ", "cycles", " ", "of", " ", "the", " ", 
    "graph"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", "allcycles", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"allcycles", "=", 
     RowBox[{"FindAllCycles", "[", "g", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
    "Print", "[", 
     "\"\<Found the following set of cycles (i.e. loops) given by a list with \
elements of the form of {cnodes,cedges}:\>\"", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<allcycles=\>\"", ",", "allcycles"}], "]"}], 
    ";"}]}]}]], "Code",
 CellChangeTimes->CompressedData["
1:eJwd0X0w0wEYB/A1rCHEURLL0gvKy4WKsaKzeelqbWi422ltvUjpOlnlKo7I
dKs0pRd3vSiUMnF2rXG97ISWqIuKo5KlVl5W9HJe+n1/fzz3+ed79zzfe5ji
dL6USqFQYoiB2gNDtDVKY3j9MZkltK3uVwYT5h/1KoFyfSUzhJAdq18NdQLN
ZiimqxNh/TaVFO5Ki0yF5tan30LbYHYfTOjvHYZNN0QjZC5TOwG7Tu2YgZUX
BGYsQkMSjwZ5v8bt4eFrjHmQbjPwDFK35+thStLlbnhPaPgCVz5XeHMIrc5a
+sAd3e8D4K3O8UA47K+PhOGSlhi4TJTIg2OaimT4vWGzBH782EG6Id4/F4rN
n8lhmrLnHMwtyFDBHt5hLWxc+Im0gX1zBuZJHahcQlXN09nQZ48HHZYGnbeD
Ykb5XHhbGOUEPbOmnKGG0ugO8/dnMuFa3+ZIuN9TzYUiY3YqlEeXkT6e7suB
ioC6E3DVdF0lnMMIqYJVSn4Nuf+8owp+e6dRQ3pP02NY+WXxd9hr2kCqksTN
kHc6c+hRhBn+a2xhVxvLDvLVLY4wYm87aZ491XILodZioxMsjqpwgdSz0W7w
0RKxF3Qo9QuAtBYuC5oWtLJhFS0jGipy38TAdt5WIWyeypJCjo0xE7Y5inKg
Iex4MSxn3S2DTwoXXof3e39XQxfH+FpYVLq3EW6zZuihz3oRqcURSQe0vmTf
CVMWFXRDddHFd/DMuqA+6Dp5ux8KkqsG4ZCzzkD2oF/4BrMNbsPwTW3KBBwv
DvgDdyXXzcC0wkMUPuFu0yQN8g0sO7hW9tMJ7sw+4QozPjx0hx9Oz2fCcgZ1
KXytlC2HL8zSA2GqnyAYnnRJCIOht5JIfRM7I6CL92gcHLIziODVhDsSODE5
IYOtsXmHoL92JB827TxYAJvZmlFIkXdOQU7kMEtAuKn+LxvqmhoUYvy520Ra
7WmhhELuaAkcLJp1A/LF7qQ6wb4HcEXqDw38nFbWCg2+46TUS1/boZVM+BLa
miVd6SIcePWHtDd07KlHiTG88F+YDprLakZ9YWyFCf4HuQRT3g==
  "]],

Cell[CellGroupData[{

Cell[BoxData["\<\"Found the following set of cycles (i.e. loops) given by a \
list with elements of the form of {cnodes,cedges}:\"\>"], "Print",
 CellChangeTimes->{
  3.7016765753964157`*^9, 3.702070875617008*^9, 3.70207101415236*^9, 
   3.702071109452986*^9, 3.702071170347192*^9, 3.7020712966255293`*^9, 
   3.702071557218083*^9, 3.702071638716427*^9, 3.702092635240074*^9, 
   3.70209347771059*^9, 3.702093595843343*^9, 3.702093719170466*^9, {
   3.702094411396646*^9, 3.702094438669009*^9}, 3.702094532715061*^9, 
   3.7020946376001*^9, 3.702095196662388*^9, 3.702095778240285*^9, 
   3.70209718175556*^9, 3.7020972321005487`*^9, 3.70209729285705*^9, {
   3.702097633682344*^9, 3.702097660798052*^9}, {3.702212097675391*^9, 
   3.702212130492096*^9}, {3.702212197249466*^9, 3.702212226831633*^9}, 
   3.70221409414431*^9, 3.702214263574222*^9, 3.702219447649271*^9, 
   3.702219559343977*^9, 3.7022196255537*^9, 3.702219844847288*^9, 
   3.702219955914299*^9, 3.702220079558585*^9, 3.702228176369135*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"allcycles=\"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "4"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}],
  SequenceForm[
  "allcycles=", {{{1, 2, 3, 1}, {1, 2, 3}}, {{1, 2, 3, 1}, {1, 2, 4}}, {{1, 3,
      1}, {3, 4}}}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7016765753964157`*^9, 3.702070875617008*^9, 3.70207101415236*^9, 
   3.702071109452986*^9, 3.702071170347192*^9, 3.7020712966255293`*^9, 
   3.702071557218083*^9, 3.702071638716427*^9, 3.702092635240074*^9, 
   3.70209347771059*^9, 3.702093595843343*^9, 3.702093719170466*^9, {
   3.702094411396646*^9, 3.702094438669009*^9}, 3.702094532715061*^9, 
   3.7020946376001*^9, 3.702095196662388*^9, 3.702095778240285*^9, 
   3.70209718175556*^9, 3.7020972321005487`*^9, 3.70209729285705*^9, {
   3.702097633682344*^9, 3.702097660798052*^9}, {3.702212097675391*^9, 
   3.702212130492096*^9}, {3.702212197249466*^9, 3.702212226831633*^9}, 
   3.70221409414431*^9, 3.702214263574222*^9, 3.702219447649271*^9, 
   3.702219559343977*^9, 3.7022196255537*^9, 3.702219844847288*^9, 
   3.702219955914299*^9, 3.702220079558585*^9, 3.702228176370874*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "nKirchhoffV", ",", "LM", ",", "eigs", ",", "tg", ",", "bstart", ",", 
     "stree", ",", "costree", ",", "fcycles"}], "]"}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Reduce", " ", "the", " ", "variables", " ", "using", " ", 
    RowBox[{"Kirchhoff", "'"}], "s", " ", "laws"}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"According", " ", "to", " ", "graph", " ", "theory"}], ",", " ", 
    RowBox[{
     RowBox[{"there", " ", "are", " ", 
      RowBox[{"Length", "[", "b", "]"}]}], "-", 
     RowBox[{"Length", "[", "n", "]"}], "+", 
     RowBox[{"1", " ", "independent", " ", 
      RowBox[{"equations", "."}]}]}]}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"To", " ", "choose", " ", "those"}], ",", " ", 
    RowBox[{
     RowBox[{"we", " ", "choose", " ", "a", " ", "spanning", " ", 
      RowBox[{"tree", ".", " ", "The"}], " ", "set", " ", "of", " ", "edges", 
      " ", "in", " ", "the", " ", "spanning", " ", "tree", "\n", "plus", " ", 
      "an", " ", "edge", " ", "from", " ", "the", " ", "corresponding", " ", 
      "co"}], "-", 
     RowBox[{"spanning", " ", "tree", " ", "contains", " ", "a", " ", 
      RowBox[{"\"\<fundamental cycle\>\"", "."}]}]}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"nKirchhoffV", "=", 
   RowBox[{
    RowBox[{"Length", "[", "b", "]"}], "-", 
    RowBox[{"Length", "[", "n", "]"}], "+", "1"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{
    "\"\<Number of (independent) Kirchhoff voltage equations: \>\"", ",", 
     "nKirchhoffV"}], "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LM", "=", 
    RowBox[{
     RowBox[{"Transpose", "[", "IM", "]"}], ".", "IM"}]}], ";"}], 
  RowBox[{"(*", "Laplacian", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"eigs", "=", 
   RowBox[{"N", "[", 
    RowBox[{"Eigenvalues", "[", "LM", "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"eigs", "=", 
   RowBox[{"DeleteCases", "[", 
    RowBox[{"eigs", ",", "0."}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tg", "=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Length", "[", "n", "]"}]}], "\[Times]", 
     RowBox[{"Product", "[", 
      RowBox[{
       RowBox[{"eigs", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "eigs", "]"}]}], "}"}]}], "]"}]}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"According", " ", "to", " ", 
    RowBox[{"Kirchhoff", "'"}], "s", " ", "theorem"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Number of spanning trees for this graph: \>\"", ",", "tg"}], 
    "]"}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Choose", " ", "a", " ", "spanning", " ", "tree"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"bstart", "=", "6"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"stree", "=", 
   RowBox[{"FindSpanningTree", "[", 
    RowBox[{"bstart", ",", "b", ",", "allcycles", ",", "nKirchhoffV"}], 
    "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{
   "finds", " ", "one", " ", "stree", " ", "for", " ", "one", " ", "bstart", 
    " ", "value"}], "*)"}], "\n", 
  RowBox[{"costree", "=", 
   RowBox[{"CospanningTree", "[", 
    RowBox[{"stree", ",", "b"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"fcycles", "=", 
   RowBox[{"FundamentalCycles", "[", 
    RowBox[{"stree", ",", "costree", ",", "allcycles", ",", "nKirchhoffV"}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{
   "\"\<For the spanning tree \>\"", ",", "stree", ",", 
    "\"\<, the fundamental cycles are fcycles=\>\"", ",", "fcycles"}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Vsols", "=", 
   RowBox[{"ReduceBranchVariables", "[", 
    RowBox[{
    "Phi", ",", "rPhi", ",", "IM", ",", "stree", ",", "g", ",", "allcycles"}],
     "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{
    "\"\<Kirchoff's voltage equations yield the solutions\\nVsols=\>\"", ",", 
     "Vsols"}], "]"}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Solve", " ", "branch", " ", "variables", " ", "with", " ", "respect", " ",
     "to", " ", "node", " ", "variables"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"Clear", "[", "Isols", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Isols", "=", 
   RowBox[{"SolveNodeVariables", "[", 
    RowBox[{"dPhi", ",", "Phi", ",", "phi", ",", "IM"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{
   "\"\<Change of variables to node variables. Korchhoff's current equations: \
\>\"", ",", "Isols"}], "]"}], ";"}]}], "Code",
 CellChangeTimes->{{3.701641934772399*^9, 3.7016419727560043`*^9}, {
   3.7016420404205513`*^9, 3.701642233220759*^9}, {3.701642311591851*^9, 
   3.701642461786654*^9}, {3.701642510827385*^9, 3.701642573225945*^9}, {
   3.701642613381111*^9, 3.7016426243230762`*^9}, 3.701642754975048*^9, {
   3.701642893033944*^9, 3.701642893494108*^9}, {3.701642927869519*^9, 
   3.701643078185401*^9}, {3.701643120637328*^9, 3.701643138292522*^9}, {
   3.701643287724697*^9, 3.701643288939725*^9}, 3.702070837006373*^9, {
   3.702071039027418*^9, 3.702071039431295*^9}, {3.702071117432784*^9, 
   3.702071117732572*^9}, {3.7020715845328007`*^9, 3.70207158515165*^9}, 
   3.7020946775149117`*^9, {3.7020971858539886`*^9, 3.702097186854671*^9}, {
   3.702097237007032*^9, 3.702097237208911*^9}, {3.702097303105176*^9, 
   3.702097303287184*^9}, 3.70209756194405*^9, {3.702212242043062*^9, 
   3.702212279626836*^9}, {3.7022281450819883`*^9, 3.702228146505323*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Number of (independent) Kirchhoff voltage equations: \"\>", 
   "\[InvisibleSpace]", "2"}],
  SequenceForm["Number of (independent) Kirchhoff voltage equations: ", 2],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7020713219026403`*^9, 3.702071560165305*^9, 3.7020716388655043`*^9, 
   3.702092635324585*^9, 3.702093477793387*^9, 3.702093599631639*^9, 
   3.7020944411152*^9, 3.7020945356627083`*^9, 3.7020946400953074`*^9, 
   3.702095198846002*^9, 3.702095781071713*^9, 3.702097196500554*^9, 
   3.7020972376604853`*^9, {3.702097295001762*^9, 3.702097303695416*^9}, 
   3.7020975625809097`*^9, 3.702097662992978*^9, {3.702212097758018*^9, 
   3.702212130560515*^9}, 3.7022121973326483`*^9, {3.702212228777277*^9, 
   3.7022122800880527`*^9}, 3.702214095905401*^9, 3.702214266055139*^9, 
   3.7022194529529953`*^9, 3.7022195613897457`*^9, 3.702219627173606*^9, 
   3.702219846572569*^9, 3.702219958158716*^9, 3.702220081467869*^9, 
   3.702228178460928*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Number of spanning trees for this graph: \"\>", 
   "\[InvisibleSpace]", "5.`"}],
  SequenceForm["Number of spanning trees for this graph: ", 5.],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7020713219026403`*^9, 3.702071560165305*^9, 3.7020716388655043`*^9, 
   3.702092635324585*^9, 3.702093477793387*^9, 3.702093599631639*^9, 
   3.7020944411152*^9, 3.7020945356627083`*^9, 3.7020946400953074`*^9, 
   3.702095198846002*^9, 3.702095781071713*^9, 3.702097196500554*^9, 
   3.7020972376604853`*^9, {3.702097295001762*^9, 3.702097303695416*^9}, 
   3.7020975625809097`*^9, 3.702097662992978*^9, {3.702212097758018*^9, 
   3.702212130560515*^9}, 3.7022121973326483`*^9, {3.702212228777277*^9, 
   3.7022122800880527`*^9}, 3.702214095905401*^9, 3.702214266055139*^9, 
   3.7022194529529953`*^9, 3.7022195613897457`*^9, 3.702219627173606*^9, 
   3.702219846572569*^9, 3.702219958158716*^9, 3.702220081467869*^9, 
   3.7022281785448627`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"For the spanning tree \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3"}], "}"}], 
   "\[InvisibleSpace]", "\<\", the fundamental cycles are fcycles=\"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}],
  SequenceForm[
  "For the spanning tree ", {2, 3}, 
   ", the fundamental cycles are fcycles=", {{{1, 2, 3, 1}, {1, 2, 3}}, {{1, 
     3, 1}, {3, 4}}}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7020713219026403`*^9, 3.702071560165305*^9, 3.7020716388655043`*^9, 
   3.702092635324585*^9, 3.702093477793387*^9, 3.702093599631639*^9, 
   3.7020944411152*^9, 3.7020945356627083`*^9, 3.7020946400953074`*^9, 
   3.702095198846002*^9, 3.702095781071713*^9, 3.702097196500554*^9, 
   3.7020972376604853`*^9, {3.702097295001762*^9, 3.702097303695416*^9}, 
   3.7020975625809097`*^9, 3.702097662992978*^9, {3.702212097758018*^9, 
   3.702212130560515*^9}, 3.7022121973326483`*^9, {3.702212228777277*^9, 
   3.7022122800880527`*^9}, 3.702214095905401*^9, 3.702214266055139*^9, 
   3.7022194529529953`*^9, 3.7022195613897457`*^9, 3.702219627173606*^9, 
   3.702219846572569*^9, 3.702219958158716*^9, 3.702220081467869*^9, 
   3.7022281785466843`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Kirchoff's voltage equations yield the solutions\\nVsols=\"\>",
    "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Phip", "\[Rule]", 
       RowBox[{
        RowBox[{"-", "PhiJ"}], "-", "Phis"}]}], ",", 
      RowBox[{"PhiJC", "\[Rule]", 
       RowBox[{"-", "PhiJ"}]}]}], "}"}], "}"}]}],
  SequenceForm[
  "Kirchoff's voltage equations yield the solutions\nVsols=", \
{{$CellContext`Phip -> -$CellContext`PhiJ - $CellContext`Phis, \
$CellContext`PhiJC -> -$CellContext`PhiJ}}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7020713219026403`*^9, 3.702071560165305*^9, 3.7020716388655043`*^9, 
   3.702092635324585*^9, 3.702093477793387*^9, 3.702093599631639*^9, 
   3.7020944411152*^9, 3.7020945356627083`*^9, 3.7020946400953074`*^9, 
   3.702095198846002*^9, 3.702095781071713*^9, 3.702097196500554*^9, 
   3.7020972376604853`*^9, {3.702097295001762*^9, 3.702097303695416*^9}, 
   3.7020975625809097`*^9, 3.702097662992978*^9, {3.702212097758018*^9, 
   3.702212130560515*^9}, 3.7022121973326483`*^9, {3.702212228777277*^9, 
   3.7022122800880527`*^9}, 3.702214095905401*^9, 3.702214266055139*^9, 
   3.7022194529529953`*^9, 3.7022195613897457`*^9, 3.702219627173606*^9, 
   3.702219846572569*^9, 3.702219958158716*^9, 3.702220081467869*^9, 
   3.702228178548049*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"sols=\"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Phis", "\[Rule]", 
       RowBox[{
        RowBox[{"-", "phignd"}], "+", "phip"}]}], ",", 
      RowBox[{"PhiJ", "\[Rule]", 
       RowBox[{"phignd", "-", "phiJ"}]}]}], "}"}], "}"}]}],
  SequenceForm[
  "sols=", {{$CellContext`Phis -> -$CellContext`phignd + $CellContext`phip, \
$CellContext`PhiJ -> $CellContext`phignd - $CellContext`phiJ}}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7020713219026403`*^9, 3.702071560165305*^9, 3.7020716388655043`*^9, 
   3.702092635324585*^9, 3.702093477793387*^9, 3.702093599631639*^9, 
   3.7020944411152*^9, 3.7020945356627083`*^9, 3.7020946400953074`*^9, 
   3.702095198846002*^9, 3.702095781071713*^9, 3.702097196500554*^9, 
   3.7020972376604853`*^9, {3.702097295001762*^9, 3.702097303695416*^9}, 
   3.7020975625809097`*^9, 3.702097662992978*^9, {3.702212097758018*^9, 
   3.702212130560515*^9}, 3.7022121973326483`*^9, {3.702212228777277*^9, 
   3.7022122800880527`*^9}, 3.702214095905401*^9, 3.702214266055139*^9, 
   3.7022194529529953`*^9, 3.7022195613897457`*^9, 3.702219627173606*^9, 
   3.702219846572569*^9, 3.702219958158716*^9, 3.702220081467869*^9, 
   3.702228178549575*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Change of variables to node variables. Korchhoff's current \
equations: \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Phis", "\[Rule]", 
       RowBox[{
        RowBox[{"-", "phignd"}], "+", "phip"}]}], ",", 
      RowBox[{"PhiJ", "\[Rule]", 
       RowBox[{"phignd", "-", "phiJ"}]}]}], "}"}], "}"}]}],
  SequenceForm[
  "Change of variables to node variables. Korchhoff's current equations: ", \
{{$CellContext`Phis -> -$CellContext`phignd + $CellContext`phip, \
$CellContext`PhiJ -> $CellContext`phignd - $CellContext`phiJ}}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7020713219026403`*^9, 3.702071560165305*^9, 3.7020716388655043`*^9, 
   3.702092635324585*^9, 3.702093477793387*^9, 3.702093599631639*^9, 
   3.7020944411152*^9, 3.7020945356627083`*^9, 3.7020946400953074`*^9, 
   3.702095198846002*^9, 3.702095781071713*^9, 3.702097196500554*^9, 
   3.7020972376604853`*^9, {3.702097295001762*^9, 3.702097303695416*^9}, 
   3.7020975625809097`*^9, 3.702097662992978*^9, {3.702212097758018*^9, 
   3.702212130560515*^9}, 3.7022121973326483`*^9, {3.702212228777277*^9, 
   3.7022122800880527`*^9}, 3.702214095905401*^9, 3.702214266055139*^9, 
   3.7022194529529953`*^9, 3.7022195613897457`*^9, 3.702219627173606*^9, 
   3.702219846572569*^9, 3.702219958158716*^9, 3.702220081467869*^9, 
   3.7022281785512133`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Identify", " ", "the", " ", "nodes", " ", "as", " ", "either", " ", 
     "ground"}], ",", " ", 
    RowBox[{"passive", " ", "or", " ", "active"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"gndnodes", ",", "anodes", ",", "pnodes", ",", "nedges"}], "]"}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"gndnodes", ",", "anodes", ",", "pnodes"}], "}"}], "=", 
     RowBox[{"ClassifyNodes", "[", 
      RowBox[{"b", ",", "btype", ",", "n", ",", "IM"}], "]"}]}], ";"}], "\n", 
   
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Found the following passive nodes: \>\"", ",", "pnodes"}], 
     "]"}], ";"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"Replace", " ", "passive", " ", "node", " ", "capacitance", " ", 
     RowBox[{"w", "/", " ", "effective"}], " ", "capacitance"}], " ", "*)"}], 
   "\n", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "aPhi", ",", "dbC", ",", "nedges", ",", "elist", ",", "e1", ",", "e2", 
      ",", "Ceff"}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"dbC", "=", "bC"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"aPhi", "=", "Phi"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{
       RowBox[{"nedges", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"IM", "[", 
             RowBox[{"[", 
              RowBox[{"pn", ",", "All"}], "]"}], "]"}], ",", "1"}], "]"}], 
          "]"}], "+", 
         RowBox[{"Length", "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"IM", "[", 
             RowBox[{"[", 
              RowBox[{"pn", ",", "All"}], "]"}], "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], ";", "\n", "  ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"nedges", "\[Equal]", "2"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", "aPhi", "]"}], "\[GreaterEqual]", 
           RowBox[{
            RowBox[{"Length", "[", "Phi", "]"}], "-", 
            RowBox[{"Length", "[", "pnodes", "]"}]}]}]}], ",", "\n", "\t", 
         RowBox[{
          RowBox[{"elist", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{
                RowBox[{"IM", "[", 
                 RowBox[{"[", 
                  RowBox[{"pn", ",", "All"}], "]"}], "]"}], ",", 
                RowBox[{"+", "1"}]}], "]"}], ",", 
              RowBox[{"Position", "[", 
               RowBox[{
                RowBox[{"IM", "[", 
                 RowBox[{"[", 
                  RowBox[{"pn", ",", "All"}], "]"}], "]"}], ",", 
                RowBox[{"-", "1"}]}], "]"}]}], "}"}], "]"}]}], ";", "\n", 
          "\t", 
          RowBox[{"e1", "=", 
           RowBox[{"elist", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", "\t", 
          RowBox[{"e2", "=", 
           RowBox[{"elist", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", "\t", 
          RowBox[{"dbC", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"dbC", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "e1", "}"}], ",", 
               RowBox[{"{", "e2", "}"}]}], "}"}]}], "]"}]}], ";", "\n", "\t", 
          
          RowBox[{"dbC", "=", 
           RowBox[{"Insert", "[", 
            RowBox[{"dbC", ",", "Ceff", ",", "e1"}], "]"}]}], ";", "\n", "\t", 
          RowBox[{"Ceff", "=", 
           RowBox[{
            RowBox[{"bC", "[", 
             RowBox[{"[", "e1", "]"}], "]"}], "\[Times]", 
            RowBox[{
             RowBox[{"bC", "[", 
              RowBox[{"[", "e2", "]"}], "]"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"bC", "[", 
                RowBox[{"[", "e1", "]"}], "]"}], "+", 
               RowBox[{"bC", "[", 
                RowBox[{"[", "e2", "]"}], "]"}]}], ")"}]}]}]}], ";", "\n", 
          "\t", 
          RowBox[{"aPhi", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"aPhi", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "e1", "}"}], ",", 
               RowBox[{"{", "e2", "}"}]}], "}"}]}], "]"}]}], ";", "\n", "\t", 
          
          RowBox[{"aPhi", "=", 
           RowBox[{"Insert", "[", 
            RowBox[{"aPhi", ",", 
             RowBox[{"Phi", "[", 
              RowBox[{"[", "e2", "]"}], "]"}], ",", "e1"}], "]"}]}], ";"}]}], 
        "\n", "  ", "]"}], ";"}], "\n", ",", 
      RowBox[{"{", 
       RowBox[{"pn", ",", "pnodes"}], "}"}]}], "]"}], ";"}]}]}]], "Code",
 CellChangeTimes->{{3.701641934772399*^9, 3.7016419727560043`*^9}, {
   3.7016420404205513`*^9, 3.701642233220759*^9}, {3.701642311591851*^9, 
   3.701642461786654*^9}, {3.701642510827385*^9, 3.701642573225945*^9}, {
   3.701642613381111*^9, 3.7016426243230762`*^9}, 3.701642754975048*^9, {
   3.701642893033944*^9, 3.701642893494108*^9}, {3.701642927869519*^9, 
   3.701643078185401*^9}, {3.701643120637328*^9, 3.701643138292522*^9}, {
   3.701643287724697*^9, 3.701643288939725*^9}, {3.701678699191922*^9, 
   3.7016787079046803`*^9}, {3.701695068206275*^9, 3.701695077554125*^9}, 
   3.7018814259479113`*^9, {3.701960713587637*^9, 3.701960724696683*^9}, {
   3.701960807211529*^9, 3.701960829908428*^9}, {3.701961425282221*^9, 
   3.701961673440694*^9}, {3.701962247015564*^9, 3.7019623484640913`*^9}, {
   3.7019623927110662`*^9, 3.70196241238419*^9}, {3.701962446943124*^9, 
   3.7019625958018713`*^9}, {3.701962813643162*^9, 3.7019628253484783`*^9}, {
   3.70196298172958*^9, 3.701962989263907*^9}, {3.701963067235654*^9, 
   3.701963160708338*^9}, {3.7020397016068583`*^9, 3.702039753742243*^9}, {
   3.702040038118479*^9, 3.7020400395811043`*^9}, {3.7020403115942698`*^9, 
   3.7020403475194387`*^9}, {3.702040423724955*^9, 3.7020404282125*^9}, {
   3.702040494316017*^9, 3.7020404952102747`*^9}, {3.702040764889629*^9, 
   3.702040771730213*^9}, {3.702064605054261*^9, 3.702064728889892*^9}, {
   3.702066740912999*^9, 3.7020667431444693`*^9}, {3.702067353805615*^9, 
   3.702067360581069*^9}, {3.7020675834538727`*^9, 3.702067642163671*^9}, {
   3.7020677363514347`*^9, 3.702067801911521*^9}, {3.7020683234587317`*^9, 
   3.702068323654052*^9}, {3.702068720604918*^9, 3.702068724287105*^9}, {
   3.702071612606621*^9, 3.702071613205859*^9}, {3.7020942825463133`*^9, 
   3.702094401258175*^9}, {3.7020945591500807`*^9, 3.70209456626998*^9}, {
   3.702094738992414*^9, 3.7020947431366796`*^9}, {3.702094879048992*^9, 
   3.7020949154907923`*^9}, {3.702095029417097*^9, 3.702095116796988*^9}, {
   3.702095168705517*^9, 3.702095211911347*^9}, {3.7020957450854473`*^9, 
   3.7020957454151783`*^9}, {3.70221402181138*^9, 3.7022140673560534`*^9}, {
   3.70221963902693*^9, 3.702219639401588*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Found the following passive nodes: \"\>", "\[InvisibleSpace]", 
   
   RowBox[{"{", "2", "}"}]}],
  SequenceForm["Found the following passive nodes: ", {2}],
  Editable->False]], "Print",
 CellChangeTimes->{{3.702219630539246*^9, 3.70221964141269*^9}, 
   3.702219849236381*^9, 3.702219961576859*^9, 3.7022200916873827`*^9, 
   3.702228202448071*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{"(*", 
   RowBox[{
   "Compute", " ", "the", " ", "capacitive", " ", "lagrangian", " ", "using", 
    " ", "node", " ", "variables"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"aPhi", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"aPhi", "/.", 
        RowBox[{"Vsols", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "/.", 
       RowBox[{
        RowBox[{"Isols", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;", 
          RowBox[{"-", "1"}]}], "]"}], "]"}]}], "/.", 
      RowBox[{"phignd", "\[Rule]", "0"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"capL", ",", "capH", ",", "aphider"}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"capL", "=", "0"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{
       RowBox[{"capL", "=", 
        RowBox[{"capL", "+", 
         RowBox[{"CapacitiveEnergy", "[", 
          RowBox[{
           RowBox[{"aPhi", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"dbC", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], ";"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"no", " ", "'"}], 
         RowBox[{"extra", "'"}], " ", "components"}], ",", " ", 
        RowBox[{
         RowBox[{"for", " ", 
          RowBox[{"dbC", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "=", 
         RowBox[{
          RowBox[{"0", " ", "for", " ", "non"}], "-", 
          RowBox[{"capacitive", " ", "branches"}]}]}]}], "*)"}], "\n", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "aPhi", "]"}]}], "}"}]}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"capL", "=", 
     RowBox[{
      RowBox[{"capL", "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"x_", "+", "y_"}], ")"}], "'"}], "\[Rule]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"x", "'"}], "+", 
          RowBox[{"y", "'"}]}], ")"}]}]}], "/.", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"-", "x_"}], ")"}], "'"}], "\[Rule]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}], "*", 
        RowBox[{"x", "'"}]}]}]}]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Mathematica", "'"}], "s", " ", "simplification", " ", "rules", 
      " ", "are", " ", "not", " ", "perfect"}], ".."}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"capL", "=", 
     RowBox[{"Limit", "[", 
      RowBox[{"capL", ",", 
       RowBox[{"Cs", "\[Rule]", "Infinity"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Capacitive Lagrangian: \>\"", ",", "capL"}], "]"}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{"Qequations", "=", 
     RowBox[{"{", "}"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"Conjugate", " ", "charges"}], "*)"}], "\n", 
    RowBox[{"aphider", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Do", "[", "\n", "  ", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"anodes", ",", "i"}], "]"}], ",", "\n", "    ", 
         RowBox[{
          RowBox[{"Qequations", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"Qequations", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Evaluate", "[", 
                RowBox[{"Symbol", "[", 
                 RowBox[{"\"\<q\>\"", "<>", 
                  RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], 
               "\[Equal]", 
               RowBox[{"D", "[", 
                RowBox[{"capL", ",", 
                 RowBox[{
                  RowBox[{"phi", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "'"}]}], "]"}]}], "}"}]}], 
            "]"}]}], ";", "\n", "    ", 
          RowBox[{"aphider", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"aphider", ",", 
             RowBox[{
              RowBox[{"phi", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "'"}]}], "]"}]}], ";"}]}], 
        "\n", "  ", "]"}], ";"}], "\n", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "phi", "]"}]}], "}"}]}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{
     "\"\<Equations for the conjugate charges: \>\"", ",", "Qequations"}], 
     "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Qsols", "=", 
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", "Qequations", "]"}], ",", "aphider"}], "]"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{"capH", "=", 
     RowBox[{"-", "capL"}]}], ";"}], "\n", 
   RowBox[{"Do", "[", "\n", "  ", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{"anodes", ",", "i"}], "]"}], ",", "\n", "    ", 
        RowBox[{
         RowBox[{"capH", "=", 
          RowBox[{"capH", "+", 
           RowBox[{
            RowBox[{
             RowBox[{"phi", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "'"}], "\[Times]", 
            RowBox[{"Evaluate", "[", 
             RowBox[{"Symbol", "[", 
              RowBox[{"\"\<q\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}]}]}], 
         ";"}]}], "\n", "  ", "]"}], ";"}], "\n", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "phi", "]"}]}], "}"}]}], "]"}], "\n", 
   RowBox[{
    RowBox[{"capH", "=", 
     RowBox[{"capH", "/.", 
      RowBox[{"Qsols", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Capacitive Hamiltonian: \>\"", ",", 
      RowBox[{"capH", "//", "Simplify"}]}], "]"}], ";"}]}]}]], "Code",
 CellChangeTimes->{{3.7019176358787394`*^9, 3.701917651491911*^9}, 
   3.701960709008329*^9, {3.702040250573098*^9, 3.702040263645993*^9}, {
   3.702066276477141*^9, 3.7020662871645803`*^9}, {3.7020665723755417`*^9, 
   3.702066579976207*^9}, {3.702066780796649*^9, 3.7020668079533052`*^9}, {
   3.702066843677855*^9, 3.7020669658184853`*^9}, {3.702067008785618*^9, 
   3.702067013594242*^9}, {3.702067052355526*^9, 3.702067072625318*^9}, {
   3.7020686700501337`*^9, 3.702068698268437*^9}, 3.702068728638612*^9, {
   3.702092619925164*^9, 3.702092632474547*^9}, {3.702093759480926*^9, 
   3.7020937641602087`*^9}, {3.7020938092936068`*^9, 3.702093828794919*^9}, {
   3.702095402443359*^9, 3.702095424763596*^9}, {3.70209568731159*^9, 
   3.702095695095096*^9}, {3.702095747256503*^9, 3.702095750097549*^9}, {
   3.7020960364399567`*^9, 3.702096047165598*^9}, {3.702096329798069*^9, 
   3.702096377382563*^9}, {3.702096501351186*^9, 3.7020965450414658`*^9}, {
   3.70209664727151*^9, 3.7020966575890617`*^9}, {3.702096732068288*^9, 
   3.7020967341331663`*^9}, {3.702097208408292*^9, 3.702097208672182*^9}, {
   3.70221306167568*^9, 3.7022131103979588`*^9}, {3.7022136231423492`*^9, 
   3.7022136308695393`*^9}, {3.7022136626161547`*^9, 3.702213756046364*^9}, {
   3.7022141260455112`*^9, 3.702214159239181*^9}, {3.702214397277478*^9, 
   3.7022143975151443`*^9}, {3.7022144949066257`*^9, 3.70221454901831*^9}, 
   3.702214614088814*^9, {3.702214692800949*^9, 3.702214713257658*^9}, 
   3.7022148929342527`*^9, {3.702215009324276*^9, 3.702215045167657*^9}, {
   3.702215132517632*^9, 3.702215132714995*^9}, {3.702215163643083*^9, 
   3.702215293641446*^9}, {3.702215665367875*^9, 3.702215671271446*^9}, {
   3.7022157094798727`*^9, 3.702215793467992*^9}, {3.702215831614921*^9, 
   3.7022159267747183`*^9}, {3.7022198583850613`*^9, 
   3.7022198688115797`*^9}, {3.7022289766127033`*^9, 3.70222903210021*^9}, {
   3.702229495247326*^9, 3.702229498326179*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Capacitive Lagrangian: \"\>", "\[InvisibleSpace]", 
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"CJC", "+", "Cp"}], ")"}], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         SuperscriptBox["phiJ", "\[Prime]",
          MultilineFunction->None], ")"}], "2"]}], "-", 
      RowBox[{"2", " ", "Cp", " ", 
       SuperscriptBox["phiJ", "\[Prime]",
        MultilineFunction->None], " ", 
       SuperscriptBox["Phis", "\[Prime]",
        MultilineFunction->None]}], "+", 
      RowBox[{"Cp", " ", 
       SuperscriptBox[
        RowBox[{"(", 
         SuperscriptBox["Phis", "\[Prime]",
          MultilineFunction->None], ")"}], "2"]}]}], ")"}]}]}],
  SequenceForm[
  "Capacitive Lagrangian: ", 
   Rational[1, 2] (($CellContext`CJC + $CellContext`Cp) 
     Derivative[1][$CellContext`phiJ]^2 - 2 $CellContext`Cp 
    Derivative[1][$CellContext`phiJ] 
    Derivative[1][$CellContext`Phis] + $CellContext`Cp 
     Derivative[1][$CellContext`Phis]^2)],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.70221517344189*^9, {3.7022152181207943`*^9, 3.702215294158393*^9}, {
   3.7022156510428*^9, 3.702215671837368*^9}, 3.7022158465362053`*^9, {
   3.702215880303157*^9, 3.702215910153583*^9}, 3.7022196465782824`*^9, {
   3.7022198514675694`*^9, 3.702219869241088*^9}, 3.7022200941316643`*^9, 
   3.702228205006723*^9, {3.7022289791005173`*^9, 3.7022290326891603`*^9}, 
   3.70222949906357*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Equations for the conjugate charges: \"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"q3", "\[Equal]", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", 
          RowBox[{"(", 
           RowBox[{"CJC", "+", "Cp"}], ")"}], " ", 
          SuperscriptBox["phiJ", "\[Prime]",
           MultilineFunction->None]}], "-", 
         RowBox[{"2", " ", "Cp", " ", 
          SuperscriptBox["Phis", "\[Prime]",
           MultilineFunction->None]}]}], ")"}]}]}], "}"}], "}"}]}],
  SequenceForm[
  "Equations for the conjugate charges: ", {{$CellContext`q3 == 
     Rational[1, 2] (
       2 ($CellContext`CJC + $CellContext`Cp) 
        Derivative[1][$CellContext`phiJ] - 2 $CellContext`Cp 
       Derivative[1][$CellContext`Phis])}}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.70221517344189*^9, {3.7022152181207943`*^9, 3.702215294158393*^9}, {
   3.7022156510428*^9, 3.702215671837368*^9}, 3.7022158465362053`*^9, {
   3.702215880303157*^9, 3.702215910153583*^9}, 3.7022196465782824`*^9, {
   3.7022198514675694`*^9, 3.702219869241088*^9}, 3.7022200941316643`*^9, 
   3.702228205006723*^9, {3.7022289791005173`*^9, 3.7022290326891603`*^9}, 
   3.702229499065476*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Capacitive Hamiltonian: \"\>", "\[InvisibleSpace]", 
   FractionBox[
    RowBox[{
     SuperscriptBox["q3", "2"], "+", 
     RowBox[{"2", " ", "Cp", " ", "q3", " ", 
      SuperscriptBox["Phis", "\[Prime]",
       MultilineFunction->None]}], "-", 
     RowBox[{"CJC", " ", "Cp", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        SuperscriptBox["Phis", "\[Prime]",
         MultilineFunction->None], ")"}], "2"]}]}], 
    RowBox[{"2", " ", 
     RowBox[{"(", 
      RowBox[{"CJC", "+", "Cp"}], ")"}]}]]}],
  SequenceForm[
  "Capacitive Hamiltonian: ", 
   Rational[1, 
     2] ($CellContext`CJC + $CellContext`Cp)^(-1) ($CellContext`q3^2 + 
    2 $CellContext`Cp $CellContext`q3 
     Derivative[1][$CellContext`Phis] - $CellContext`CJC $CellContext`Cp 
    Derivative[1][$CellContext`Phis]^2)],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.70221517344189*^9, {3.7022152181207943`*^9, 3.702215294158393*^9}, {
   3.7022156510428*^9, 3.702215671837368*^9}, 3.7022158465362053`*^9, {
   3.702215880303157*^9, 3.702215910153583*^9}, 3.7022196465782824`*^9, {
   3.7022198514675694`*^9, 3.702219869241088*^9}, 3.7022200941316643`*^9, 
   3.702228205006723*^9, {3.7022289791005173`*^9, 3.7022290326891603`*^9}, 
   3.7022294990676517`*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{835, 727},
WindowMargins->{{Automatic, 110}, {Automatic, 23}},
ShowSelection->True,
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (November 20, \
2012)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 1177, 27, 97, "Input"],
Cell[1737, 49, 2334, 49, 334, "Text"],
Cell[4074, 100, 4315, 120, 382, "Code"],
Cell[8392, 222, 3318, 83, 222, "Code"],
Cell[CellGroupData[{
Cell[11735, 309, 5217, 137, 647, "Code"],
Cell[CellGroupData[{
Cell[16977, 450, 1244, 22, 22, "Print"],
Cell[18224, 474, 6053, 138, 370, "Print"],
Cell[24280, 614, 1914, 41, 54, "Print"],
Cell[26197, 657, 993, 15, 38, "Print"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[27239, 678, 1801, 40, 114, "Code"],
Cell[CellGroupData[{
Cell[29065, 722, 1008, 14, 38, "Print"],
Cell[30076, 738, 1733, 39, 22, "Print"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[31858, 783, 5576, 142, 434, "Code"],
Cell[CellGroupData[{
Cell[37459, 929, 1015, 17, 22, "Print"],
Cell[38477, 948, 996, 17, 22, "Print"],
Cell[39476, 967, 1636, 37, 38, "Print"],
Cell[41115, 1006, 1365, 28, 38, "Print"],
Cell[42483, 1036, 1289, 26, 22, "Print"],
Cell[43775, 1064, 1425, 28, 38, "Print"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[45249, 1098, 6969, 160, 377, "Code"],
Cell[52221, 1260, 399, 9, 22, "Print"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52657, 1274, 7816, 200, 480, "Code"],
Cell[CellGroupData[{
Cell[60498, 1478, 1535, 38, 38, "Print"],
Cell[62036, 1518, 1323, 32, 38, "Print"],
Cell[63362, 1552, 1298, 31, 44, "Print"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
